<dom-module id="timeoff-creation">

  <link rel="import" type="css" href="timeoff-creation.css">
  <script src="../../bower_components/es6-promise/promise.min.js"></script>

  <template>
    <nuxeo-resource id="nxr" path="workflow" method="post" data="{{data}}"></nuxeo-resource>
    <paper-button raised on-click="openDialog">Submit a new request</paper-button>

    <dialog-request-creation id="dialog" data="{{data}}" on-submit="_submit"></dialog-request-creation>

  </template>
  <script>
    (function() {
      Polymer({
        is: 'timeoff-creation',
        properties: {
          data: Object,
        },

        ready: function() {
          this._reset();
        },
        openDialog: function() {
          this.$.dialog.open();
        },
        _submit: function() {
          this.$.nxr.post().then(function() {
            app.$.toast.text = 'Your request has been created.';
            app.$.toast.show();

            this._reset();
            this.fire('create-request');
          }.bind(this));
        },
        _reset: function() {
          this.data = {
            'variables': {
              'begin': moment().toDate(),
              'end': moment().toDate(),
              'numberHoliday': null,
              'numberRTT': null,
              'numberFamilyCause': null,
              'numberUnpaid': null,
              'commentRequester': ''
            },
            'workflowModelName': 'TimeOffRequestFlow'
          };
        },
        editRequest: function() {
          // Edit is delete then create.
          var that = this;
          this.$.delete.execute().then(function() {
            that.createRequest();
          });
        }
      });
    }());
  </script>
</dom-module>

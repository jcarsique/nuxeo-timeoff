<dom-module id="timeoff-creation">

  <link rel="import" type="css" href="timeoff-creation.css">
  <script src="../../bower_components/es6-promise/promise.min.js"></script>

  <template>
    <nuxeo-connection id="nx"></nuxeo-connection>
    <nuxeo-resource id="nxr" path="workflow" method="post" data="{{data}}"></nuxeo-resource>
    <paper-button raised on-click="openDialog">plain dialog</paper-button>

    <paper-dialog id="dialog" class="paper-date-picker-dialog" with-backdrop>
      <h2 class="header">New timeoff request</h2>

      <paper-dialog-scrollable>
        <form is="iron-form" id="form">
          <label>Start date</label>
          <paper-date-picker id="startDate" date="{{data.variables.begin}}"></paper-date-picker>
          <label>End date</label>
          <paper-date-picker id="endDate" date="{{data.variables.end}}"></paper-date-picker>
          <paper-input value="{{data.variables.numberVacation}}" label="Paid holiday" min="0" prevent-invalid-input allowed-pattern="[0-9]" auto-validate></paper-input>
          <paper-input value="{{data.variables.numberRTT}}" label="RTT" min="0" prevent-invalid-input allowed-pattern="[0-9]" auto-validate></paper-input>
          <paper-input value="{{data.variables.numberFamilyReason}}" label="Family" min="0" prevent-invalid-input allowed-pattern="[0-9]" auto-validate></paper-input>
          <paper-input value="{{data.variables.numberUnpaid}}" label="Unpaid holiday" min="0" prevent-invalid-input allowed-pattern="[0-9]" auto-validate></paper-input>
          <paper-textarea value="{{data.variables.comment_requester}}" label="Comment"></paper-textarea>
        </form>
      </paper-dialog-scrollable>

      <div class="buttons footer">
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm on-click="createRequest">Accept</paper-button>
      </div>
    </paper-dialog>

  </template>
  <script>
    (function() {
      Polymer({
        is: 'timeoff-creation',
        properties: {
          data: Object
        },

        ready: function() {
          this.data = {
            'variables': {
              'begin': moment().toDate(),
              'end': moment().toDate(),
              'numberVacation': null,
              'numberRTT': null,
              'numberFamilyReason': null,
              'numberUnpaid': null,
              'comment_requester': ''
            },
            'workflowModelName': 'TimeOffRequestFlow'
          };
        },
        openDialog: function() {
          this.$.dialog.open();
        },
        createRequest: function() {
          this.$.nxr.post().then(function(response) {
            this.fire('create-request');

            app.$.toast.text = 'Your request has been created.';
            app.$.toast.show();
          }.bind(this));
        }
      });
    }());
  </script>
</dom-module>

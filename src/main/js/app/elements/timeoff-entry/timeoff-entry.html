<dom-module id="timeoff-entry">
  <link rel="import" type="css" href="timeoff-entry.css">

  <template>
    <template is="dom-if" if="{{data}}">
      <div class="timeoff flex-horizontal">
        <div class="interval">[[beginning]] - [[end]]</div>
        <div class="numberHoliday">H:[[holiday]]</div>
        <div class="numberRTT">R:[[RTT]]</div>
        <div class="numberFamilyCause">F:[[familyCause]]</div>
        <div class="numberUnpaid">U:[[unPaid]]</div>
        <content></content>
      </div>
    </template>
  </template>
</dom-module>
<script>
  (function() {
    Polymer({
      is: 'timeoff-entry',
      properties: {
        data: {
          type: Object,
          value: null
        },
        beginning: {
          type: String,
          computed: 'readBeginning(data)'
        },
        end: {
          type: String,
          computed: 'readEnd(data)'
        },
        holiday: {
          type: String,
          computed: 'readHoliday(data)'
        },
        RTT: {
          type: String,
          computed: 'readRTT(data)'
        },
        familyCause: {
          type: String,
          computed: 'readFamilyCause(data)'
        },
        unPaid: {
          type: String,
          computed: 'readUnpaid(data)'
        }
      },
      readBeginning: function() {
        return this.readProperty('beginning', 'll');
      },
      readEnd: function() {
        return this.readProperty('end', 'll');
      },
      readHoliday: function() {
        return this.readInt('numberHoliday');
      },
      readRTT: function() {
        return this.readInt('numberRTT');
      },
      readFamilyCause: function() {
        return this.readInt('numberFamilyCause');
      },
      readUnpaid: function() {
        return this.readInt('numberUnpaid');
      },
      readInt: function(prop) {
        return parseInt(this.readProperty(prop)) || 0;
      },
      readProperty: function(prop, format) {
        var val;
        switch (this.data['entity-type']) {
          case 'document':
            val = this.data.properties['hrholidayrequest:' + prop];
            break;
          case 'task':
          case 'workflow':
            val = this.data.variables[prop];
            break;
          default:
            console.log('[timeoff-entry] Unknown entity-type ' + this.data['entity-type']);
        }

        if (typeof format === 'undefined') {
          return val;
        } else {
          return moment(val).format(format); // Localized readable format
        }
      }
    });
  }());
</script>
